<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SystÃ¨me de PrÃ©sence - Reconnaissance Faciale</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <img src="logo isimm.png" alt="Logo ISIMM" class="logo">
            </div>
            <div class="header-text">
                <h1>Institut SupÃ©rieur d'Informatique et de MathÃ©matiques de Monastir</h1>
                <h2 class="system-title">ğŸ“ SystÃ¨me de PrÃ©sence par Reconnaissance Faciale</h2>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-btn active" onclick="showTab('etudiants', event)">ğŸ‘¤ Ã‰tudiants</button>
            <button class="tab-btn" onclick="showTab('cours', event)">ğŸ“š Cours</button>
            <button class="tab-btn" onclick="showTab('presence', event)">âœ… PrÃ©sence</button>
            <button class="tab-btn" onclick="showTab('rapports', event)">ğŸ“Š Rapports</button>
        </nav>

        <!-- Onglet Ã‰tudiants -->
        <div id="etudiants" class="tab-content active">
            <div class="card">
                <h2>â• Ajouter un Ã‰tudiant</h2>
                <form id="addStudentForm" class="form">
                    <div class="form-group">
                        <label for="studentId">ID Ã‰tudiant *</label>
                        <input type="text" id="studentId" placeholder="Ex: ETU001" required>
                    </div>
                    <div class="form-group">
                        <label for="studentName">Nom Complet *</label>
                        <input type="text" id="studentName" placeholder="Ex: Dhaffar Nourhene" required>
                    </div>
                    <div class="form-group">
                        <label for="studentEmail">Email</label>
                        <input type="email" id="studentEmail" placeholder="Ex: dhaffar@example.com">
                    </div>
                    <div class="form-group">
                        <label for="studentPhoto">Photo *</label>
                        <input type="file" id="studentPhoto" accept="image/*" required>
                        <div id="photoPreview" class="photo-preview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary">Ajouter l'Ã‰tudiant</button>
                </form>
            </div>

            <div class="card">
                <h2>ğŸ“‹ Liste des Ã‰tudiants</h2>
                <div class="search-box">
                    <input type="text" id="searchStudent" placeholder="ğŸ” Rechercher un Ã©tudiant...">
                </div>
                <div id="studentsList" class="list"></div>
            </div>
        </div>

        <!-- Onglet Cours -->
        <div id="cours" class="tab-content">
            <div class="card">
                <h2>â• CrÃ©er un Cours</h2>
                <form id="addCourseForm" class="form">
                    <div class="form-group">
                        <label for="courseId">Code Cours *</label>
                        <input type="text" id="courseId" placeholder="Ex: INFO101" required>
                    </div>
                    <div class="form-group">
                        <label for="courseName">Nom du Cours *</label>
                        <input type="text" id="courseName" placeholder="Ex: Programmation Python" required>
                    </div>
                    <div class="form-group">
                        <label for="courseProf">Professeur</label>
                        <input type="text" id="courseProf" placeholder="Ex: Dr. Mohamed">
                    </div>
                    <div class="form-group">
                        <label for="courseProfEmail">Email du Professeur *</label>
                        <input type="email" id="courseProfEmail" placeholder="Ex: mohamed@isimm.u-monastir.tn" required>
                    </div>
                    <button type="submit" class="btn btn-primary">CrÃ©er le Cours</button>
                </form>
            </div>

            <div class="card">
                <h2>ğŸ“š Liste des Cours</h2>
                <div id="coursesList" class="list"></div>
            </div>
        </div>

        <!-- Onglet PrÃ©sence -->
        <div id="presence" class="tab-content">
            <!-- Capture Webcam en Direct -->
            <div class="card">
                <h2>ğŸ“¹ Prise de PrÃ©sence en Temps RÃ©el</h2>
                <p style="color: #666; margin-bottom: 15px;">
                    ğŸ¥ Chaque Ã©tudiant passe devant la webcam, son nom s'affiche automatiquement et il est ajoutÃ© Ã  la liste de prÃ©sence
                </p>
                
                <div class="form-group">
                    <label for="webcamCourseId">Code du Cours *</label>
                    <select id="webcamCourseId" required>
                        <option value="">-- SÃ©lectionner un cours --</option>
                    </select>
                </div>
                
                <div class="webcam-container" style="margin: 20px 0; text-align: center;">
                    <video id="webcam" autoplay playsinline style="width:100%; max-width:640px; border-radius:10px; background:#000; display:none;"></video>
                    <canvas id="webcamCanvas" style="display:none;"></canvas>
                    <div id="webcamPlaceholder" style="width:100%; max-width:640px; height:480px; background:#f0f0f0; border-radius:10px; display:flex; align-items:center; justify-content:center; margin:0 auto;">
                        <p style="color:#999;">ğŸ“¹ La webcam s'affichera ici</p>
                    </div>
                </div>
                
                <div class="button-group" style="display:flex; gap:10px; flex-wrap:wrap; justify-content:center; margin:15px 0;">
                    <button id="startWebcam" class="btn btn-primary">
                        ğŸ¥ DÃ©marrer la Capture
                    </button>
                    <button id="captureNextBtn" class="btn btn-success" style="display:none; font-size:1.1em; padding:12px 25px;">
                        ğŸ‘¤ Capturer Ã‰tudiant
                    </button>
                    <button id="nextStudentBtn" class="btn btn-warning" style="display:none;">
                        â¡ï¸ Ã‰tudiant Suivant
                    </button>
                    <button id="stopWebcam" class="btn btn-danger" style="display:none;">
                        â¹ï¸ Terminer et Enregistrer
                    </button>
                </div>
                
                <!-- Zone d'affichage en temps rÃ©el -->
                <div id="liveRecognition" style="display:none; margin-top: 20px;">
                    <div id="currentRecognition" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); padding: 20px; border-radius: 10px; color: white; text-align: center; margin-bottom: 20px;">
                        <h4 style="margin: 0 0 10px 0;">Visage DÃ©tectÃ©:</h4>
                        <h2 id="currentRecognizedName" style="margin: 0; font-size: 2.5em;">En attente...</h2>
                        <p id="recognitionStatus" style="margin: 10px 0 0 0; font-size: 1.1em; opacity: 0.9;">Placez-vous devant la webcam</p>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div style="background: #d4edda; padding: 15px; border-radius: 10px; border: 2px solid #28a745;">
                            <h4 style="margin: 0 0 10px 0; color: #155724;">âœ… PrÃ©sents (<span id="livePresentsCount">0</span>)</h4>
                            <div id="livePresents" style="max-height: 200px; overflow-y: auto;"></div>
                        </div>
                        
                        <div style="background: #f8d7da; padding: 15px; border-radius: 10px; border: 2px solid #dc3545;">
                            <h4 style="margin: 0 0 10px 0; color: #721c24;">âŒ Absents (<span id="liveAbsentsCount">0</span>)</h4>
                            <div id="liveAbsents" style="max-height: 200px; overflow-y: auto;"></div>
                        </div>
                    </div>
                </div>
                
                <div id="webcamStatus" style="margin-top: 20px;"></div>
            </div>

            <!-- Upload VidÃ©o -->
            <div class="card">
                <h2>ğŸ“¹ Upload VidÃ©o</h2>
                <p style="color: #666; margin-bottom: 15px;">
                    ğŸ“ Enregistrez une vidÃ©o et uploadez-la pour l'analyse
                </p>
                <form id="takeAttendanceForm" class="form">
                    <div class="form-group">
                        <label for="attendanceCourse">SÃ©lectionner le Cours *</label>
                        <select id="attendanceCourse" required>
                            <option value="">-- Choisir un cours --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="attendanceVideo">VidÃ©o de la Classe *</label>
                        <input type="file" id="attendanceVideo" accept="video/*" required>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="sendEmailToProf" checked>
                            Envoyer la liste de prÃ©sence par email au professeur
                        </label>
                    </div>
                    <button type="submit" class="btn btn-success">Analyser la VidÃ©o</button>
                </form>
                <div id="attendanceResult" class="result-box"></div>
            </div>

            <div class="card">
                <h2>ğŸ“… Historique des PrÃ©sences</h2>
                <div id="attendanceHistory" class="list"></div>
            </div>
        </div>

        <!-- Onglet Rapports -->
        <div id="rapports" class="tab-content">
            <div class="card">
                <h2>ğŸ“Š GÃ©nÃ©rer un Rapport</h2>
                <form id="generateReportForm" class="form">
                    <div class="form-group">
                        <label for="reportCourse">Cours</label>
                        <select id="reportCourse">
                            <option value="">-- Tous les cours --</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="reportStartDate">Date de DÃ©but</label>
                        <input type="date" id="reportStartDate">
                    </div>
                    <div class="form-group">
                        <label for="reportEndDate">Date de Fin</label>
                        <input type="date" id="reportEndDate">
                    </div>
                    <button type="submit" class="btn btn-success">ğŸ“¥ TÃ©lÃ©charger le Rapport Excel</button>
                </form>
            </div>

            <div class="card">
                <h2>ğŸ“ˆ Statistiques</h2>
                <div id="statistics" class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalStudents">-</div>
                        <div class="stat-label">Ã‰tudiants</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalCourses">-</div>
                        <div class="stat-label">Cours</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="totalAttendances">-</div>
                        <div class="stat-label">PrÃ©sences</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgAttendance">-</div>
                        <div class="stat-label">Taux Moyen</div>
                    </div>
                </div>
            </div>
        </div>

        <div id="notification" class="notification"></div>
    </div>

    <script src="script.js"></script>
</body>
</html>
